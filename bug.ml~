
open Functory.Cores

let _ = Random.self_init ()
let _ = set_number_of_cores 16

let n = int_of_string Sys.argv.(1)

let rec fib n = if n <= 1 then 1 else (fib (n-1)) + (fib (n-2))
let counter = ref n

let rec constant_list elt length =
  if length <= 0 then []
  else elt::(constant_list elt (length -1))

let _ = compute
  ~worker:(fun _ -> fib 32)
  ~master:(fun (_,()) i -> decr counter; if !counter < 0 then [] else [(),()])
  (constant_list ((),()) 20) 
